
//// cactus version
params.cactus_version = "15.08.22"

nextflow.enable.dsl=1

cactus_version = params.cactus_version

//// analysis directories
params.cactus_dir =  "/home/jersal/workspace/cactus"

params {
  //// output
  out_dir     =  "results/${cactus_version}"
	pub_mode    = 'link'  
	
	//// allocated ressources 
	memory_picard     = '20G'
  
	nb_threads  = 6
	executor {
		queueSize = 50
		$local { 
      memory  = '80 GB' // total memory used by Nextlow on the server
    }
	}

}

// configuration files
includeConfig 'conf/containers.config'
includeConfig "conf/run_base.config"
custom_config = "${PWD}/conf/run.config"
if(new File("${custom_config}").isFile()) includeConfig "${custom_config}"


//// species


// m_.*: groovy maps
// https://code-maven.com/groovy-map

/// Effective genome size
// https://test-argparse-readoc.readthedocs.io/en/latest/content/feature/effectiveGenomeSize.html
// https://deeptools.readthedocs.io/en/develop/content/feature/effectiveGenomeSize.html
def m_effective_genome_size = [
  human: '2913022398', 
  mouse: '2652783500',
    fly: '142573017',
   worm: '100286401'
]
// => same as the mappable genome size used by macs2

def m_genome_assembly_nickname = [
  human: 'hg38', 
  mouse: 'mm10',
    fly: 'dm6',
   worm: 'ce11'
]
specie = params.specie
genome_assembly_nickname = m_genome_assembly_nickname[specie]

specie_dir = "${params.cactus_dir}/data/${specie}"
genome_dir = "${specie_dir}/genome/sequence"
anno_dir   = "${specie_dir}/genome/annotation"

params{
  effective_genome_size  = m_effective_genome_size[specie]
  bowtie2_indexes_contam = "${specie_dir}/bowtie2_indexes_conta/genome_contamination"
  
  bowtie2_indexes        = "${genome_dir}/bowtie2_indexes/genome"
  kallisto_transcriptome = "${genome_dir}/transcriptome_kallisto_index"
  
  chromosomes_sizes      = "${anno_dir}/filtered/chromosomes_sizes.txt"
  blacklisted_regions    = "${anno_dir}/blacklisted_regions.bed"
  bed_regions            = "${anno_dir}/bed_regions"
  
  org_db                 = "${anno_dir}/R/orgdb.sqlite"
  txdb                   = "${anno_dir}/R/txdb.sqlite"
  cur_seqinfo            = "${anno_dir}/R/seqinfo.rds"
  df_genes_metadata      = "${anno_dir}/R/df_genes_metadata.rds"
  df_genes_transcripts   = "${anno_dir}/R/df_genes_transcripts.rds"
  promoters_df           = "${anno_dir}/R/promoters_df.rds"
  kegg_environment       = "${anno_dir}/R/kegg_environment.rds"
  promoters_bed          = "${anno_dir}/R/promoters.bed"
  
  pwms_motifs            = "${specie_dir}/homer_data/homer_motifs.txt"
  homer_genome           = "${specie_dir}/homer_data/genomes/${genome_assembly_nickname}"
  encode_chip_files      = "${specie_dir}/CHIP"
  chip_ontology_groups   = "${specie_dir}/CHIP/chip_ontology_groups.tsv"
  chromatin_state_1      = "${specie_dir}/chromatin_states/${params.chromatin_state}"
}

// note: the parameter "params.chromatin_state" should be defined in the run.config file

// println "${genome_assembly_nickname}"
// println "${params.homer_genome}"
// println "${params.effective_genome_size}"


// tower token
tower {
	// accessToken = 'fd3114de75cc045443c804ffa7d7213e1fcf0c85' // KI
  accessToken = '3730e17fdb910dfab1b82c6b8217bdd43898e1f1' // hotmail
  enabled     = false
}

//// cache
resume = true
cache  = 'deep'

//// containers
singularity_containers_path = '/home/jersal/workspace/singularity_containers'
singularity {
  cacheDir = singularity_containers_path
  libraryDir = singularity_containers_path
	enabled    = true
	autoMounts = true
  // runOptions = "--containall --cleanenv --home ${PWD} --workdir tmp -B ${params.cactus_dir}"
  runOptions = "--containall --cleanenv --home ${PWD} --workdir ${params.cactus_dir}/tmp"
	// runOptions = "--containall --cleanenv --home ${PWD} -B ${params.cactus_dir}"
}



//// report files
import java.text.SimpleDateFormat
def date     = new Date()
sdf          = new SimpleDateFormat("MM-dd-yyyy_HH_mm_ss")
current_date = sdf.format(date)

timeline {
	enabled = true
	file    = "${params.out_dir}/Run_Info/${current_date}/timeline.html"
}

report {
	enabled = true
	file    = "${params.out_dir}/Run_Info/${current_date}/report.html"
}

dag {
	enabled = true
  file    = "${params.out_dir}/Run_Info/${current_date}/dag.mmd"
}




